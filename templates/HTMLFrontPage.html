{% extends 'base.html' %}
{% block content %}
    <video id="video" width="640" height="480" autoplay></video>
    <button id="snap">Snap Photo</button>
    <canvas id="canvas" width="640" height="480"></canvas>
    <p id="result"></p>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <script>

        var video = document.getElementById('video');

        if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
            video.srcObject = stream;
            video.play();
            });
        }

        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        var video = document.getElementById('video');

        document.getElementById("snap").addEventListener("click", function() {
            let dataURLs = [];
            for (let i = 0; i < 10; i++) {
                context.drawImage(video, 0, 0, 640, 480);
                var dataURL = canvas.toDataURL();
                dataURLs[i] = dataURL;
            }
            var json_string = JSON.stringify(dataURLs);

            console.log('Picture taken')
            $.ajax({
                type: "POST",
                url: "{% url 'get_emotion' %}",
                data: { 
                    imgBase64: json_string
                }
            }).done(function(request) {
                console.log('Result returned from backend'); 
                $("#result").empty();
                $("#result").append(request);
                // If you want the file to be visible in the browser 
                // - please modify the callback in javascript. All you
                // need is to return the url to the file, you just saved 
                // and than put the image in your browser.
            });
        });
	
    </script>


{% endblock %}